<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lost & Found ‚Äì T√¨m ƒë·ªì th·∫•t l·∫°c</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="app/app.css" rel="stylesheet" />
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Roboto", sans-serif;
      }
      .lf-hero {
        background: linear-gradient(135deg, #0f3b8a, #154e8d);
        color: #fff;
        border-radius: 18px;
        padding: 32px 28px;
        margin-bottom: 24px;
      }
      .lf-hero h1 {
        font-weight: 700;
        letter-spacing: 0.3px;
      }
      .lf-hero p {
        opacity: 0.9;
      }
      .lf-status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 4px 10px;
        background: rgba(255, 255, 255, 0.08);
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar lf-navbar sticky-top">
      <div class="container py-2">
        <a class="navbar-brand fw-bold" href="./index.html">
          Lost <span class="text-primary">&amp;</span> Found
        </a>
        <div class="d-flex gap-2 align-items-center">
          <a class="btn btn-outline-secondary btn-sm" href="app/create.html">ƒêƒÉng tin</a>
          <a class="btn btn-outline-secondary btn-sm" href="app/my.html">Tin c·ªßa t√¥i</a>
          <a class="btn btn-outline-primary btn-sm" data-lf-login href="app/login.html">ƒêƒÉng nh·∫≠p</a>
          <a class="btn btn-outline-danger btn-sm d-none" data-lf-logout href="#">ƒêƒÉng xu·∫•t</a>
          <span class="small lf-muted ms-2" data-lf-user></span>
        </div>
      </div>
    </nav>

    <main class="container my-4">
      <section class="lf-hero">
        <div class="row g-3 align-items-center">
          <div class="col-12 col-md-8">
            <div class="lf-status-pill mb-2">
              <span class="badge bg-info me-1">&bull;</span>
              H·ªá th·ªëng h·ªó tr·ª£ match Lost/Found, claim v√† h·∫πn tr·∫£ ƒë·ªì
            </div>
            <h1 class="h3 mb-2">T√¨m l·∫°i ƒë·ªì th·∫•t l·∫°c, nhanh v√† an to√†n.</h1>
            <p class="mb-3">
              ƒêƒÉng tin Lost/Found, h·ªá th·ªëng s·∫Ω g·ª£i √Ω match, qu·∫£n l√Ω claim v√† tr·∫°ng th√°i trao tr·∫£.
            </p>
            <div class="d-flex flex-wrap gap-2">
              <a href="app/create.html" class="btn btn-light btn-sm">ƒêƒÉng tin ngay</a>
              <a href="#lf-root" class="btn btn-outline-light btn-sm">Xem c√°c tin m·ªõi</a>
            </div>
          </div>
          <div class="col-12 col-md-4 text-md-end">
            <div class="small mb-1">Tr·∫°ng th√°i nhanh</div>
            <div class="d-flex flex-wrap gap-2 justify-content-md-end">
              <span class="badge lf-badge-pending">PENDING</span>
              <span class="badge lf-badge-approved">APPROVED</span>
              <span class="badge lf-badge-returned">RETURNED</span>
            </div>
          </div>
        </div>
      </section>

      <section class="row g-3" id="lf-root">
        <div class="col-12 col-lg-4">
          <div class="lf-card p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">B·ªô l·ªçc</h5>
              <button class="btn btn-sm btn-outline-secondary" id="btnReset">Reset</button>
            </div>
            <div class="mb-2">
              <label class="form-label">Lo·∫°i</label>
              <select class="form-select" id="fType">
                <option value="">T·∫•t c·∫£</option>
                <option value="LOST">ƒê·ªì b·ªã m·∫•t</option>
                <option value="FOUND">ƒê·ªì nh·∫∑t ƒë∆∞·ª£c</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Danh m·ª•c (category)</label>
              <input class="form-control" id="fCategory" placeholder="Wallet, Phone, Papers‚Ä¶" />
            </div>
            <div class="mb-2">
              <label class="form-label">ƒê·ªãa ƒëi·ªÉm (location)</label>
              <input class="form-control" id="fLocation" placeholder="T√≤a A, cƒÉng tin‚Ä¶" />
            </div>
            <div class="mb-3">
              <label class="form-label">Tr·∫°ng th√°i</label>
              <select class="form-select" id="fStatus">
                <option value="">T·∫•t c·∫£</option>
                <option value="PENDING_APPROVAL">PENDING_APPROVAL</option>
                <option value="APPROVED">APPROVED</option>
                <option value="REJECTED">REJECTED</option>
                <option value="MATCHED">MATCHED</option>
                <option value="RETURN_PENDING">RETURN_PENDING</option>
                <option value="RETURNED">RETURNED</option>
                <option value="CLOSED">CLOSED</option>
              </select>
            </div>
            <button class="btn btn-primary w-100" id="btnApply">√Åp d·ª•ng</button>
            <div class="lf-form-help mt-2">
              Backend: <code id="baseUrl"></code>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h4 class="mb-0">Tin ƒëƒÉng</h4>
            <button class="btn btn-outline-secondary btn-sm" id="btnReload">T·∫£i l·∫°i</button>
          </div>

          <div id="alert" class="alert alert-danger d-none" role="alert"></div>
          <div id="loading" class="lf-card p-4">ƒêang t·∫£i‚Ä¶</div>
          <div id="list" class="row g-3 d-none"></div>
        </div>
      </section>
    </main>

    <script src="app/app.js"></script>
    <script>
      LF.wireNavbar();
      document.getElementById("baseUrl").textContent = LF.getBaseUrl();

      const elAlert = document.getElementById("alert");
      const elLoading = document.getElementById("loading");
      const elList = document.getElementById("list");

      function showError(err) {
        elAlert.classList.remove("d-none");
        elAlert.textContent = err?.message || String(err);
      }

      function clearError() {
        elAlert.classList.add("d-none");
        elAlert.textContent = "";
      }

      function card(item) {
        const img = (item.images && item.images[0]) ? item.images[0] : null;
        const date = item.lost_found_date || item.createdAt || item.created_at;
        return `
          <div class="col-12 col-md-6">
            <div class="lf-card p-3 h-100">
              ${img
                ? `<img class="lf-img-thumb mb-2" src="${img}" alt="·∫¢nh: ${(item.title || '').replace(/"/g, '')}" loading="lazy" />`
                : `<div class="lf-img-thumb mb-2 d-flex align-items-center justify-content-center lf-muted">No image</div>`}
              <div class="d-flex justify-content-between align-items-start gap-2">
                <div>
                  <div class="small lf-muted">${item.type || ""} ‚Ä¢ ${item.category || ""}</div>
                  <div class="fw-semibold">${item.title || ""}</div>
                </div>
                <div>${LF.statusBadge(item.status)}</div>
              </div>
              <div class="small mt-2 lf-muted">
                ${item.location_text ? `üìç ${item.location_text}` : ""} ${date ? ` ‚Ä¢ üïí ${LF.fmtDate(date)}` : ""}
              </div>
            </div>
          </div>
        `;
      }

      async function load() {
        clearError();
        elLoading.classList.remove("d-none");
        elList.classList.add("d-none");
        elList.innerHTML = "";
        try {
          const filters = {
            type: document.getElementById("fType").value,
            category: document.getElementById("fCategory").value,
            location: document.getElementById("fLocation").value,
            status: document.getElementById("fStatus").value,
          };
          const items = await LF.listItems(filters);
          elList.innerHTML = (items || []).map(card).join("");
          elLoading.classList.add("d-none");
          elList.classList.remove("d-none");
        } catch (e) {
          elLoading.classList.add("d-none");
          showError(e);
        }
      }

      document.getElementById("btnApply").addEventListener("click", load);
      document.getElementById("btnReload").addEventListener("click", load);
      document.getElementById("btnReset").addEventListener("click", () => {
        document.getElementById("fType").value = "";
        document.getElementById("fCategory").value = "";
        document.getElementById("fLocation").value = "";
        document.getElementById("fStatus").value = "";
        load();
      });

      load();
    </script>
  </body>
</html>

