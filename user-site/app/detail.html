<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lost & Found - Chi ti·∫øt tin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="./app.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar lf-navbar">
      <div class="container py-2">
        <a class="navbar-brand fw-bold" href="/index.html">Lost & Found</a>
        <div class="d-flex gap-2 align-items-center">
          <a class="btn btn-outline-secondary btn-sm" href="./create.html">ƒêƒÉng tin</a>
          <a class="btn btn-outline-secondary btn-sm" href="./my.html">Tin c·ªßa t√¥i</a>
          <a class="btn btn-outline-primary btn-sm" data-lf-login href="./login.html">ƒêƒÉng nh·∫≠p</a>
          <a class="btn btn-outline-danger btn-sm d-none" data-lf-logout href="#">ƒêƒÉng xu·∫•t</a>
          <span class="small lf-muted ms-2" data-lf-user></span>
        </div>
      </div>
    </nav>

    <main class="container my-4">
      <div id="alert" class="alert alert-danger d-none"></div>
      <div id="loading" class="lf-card p-4">ƒêang t·∫£i...</div>
      <div id="wrap" class="d-none"></div>
    </main>

    <script src="./app.js"></script>
    <script>
      LF.wireNavbar();

      const elAlert = document.getElementById("alert");
      const elLoading = document.getElementById("loading");
      const elWrap = document.getElementById("wrap");

      function showError(err) {
        elAlert.classList.remove("d-none");
        elAlert.textContent = err?.message || String(err);
      }

      function getId() {
        const p = new URLSearchParams(location.search);
        return p.get("id");
      }

      function render(item) {
        const imgs = Array.isArray(item.images) ? item.images : [];
        const date = item.lost_found_date || item.createdAt || item.created_at;
        const user = LF.getUser();
        const isOwner = user && item.created_by && (String(item.created_by) === String(user.id));

        elWrap.innerHTML = `
          <div class="row g-3">
            <div class="col-12 col-lg-6">
              <div class="lf-card p-3">
                <div class="d-flex justify-content-between align-items-start gap-2">
                  <div>
                    <div class="small lf-muted">${item.type || ""} ‚Ä¢ ${item.category || ""}</div>
                    <h3 class="mb-1">${item.title || ""}</h3>
                  </div>
                  <div>${LF.statusBadge(item.status)}</div>
                </div>
                <div class="lf-muted mb-2">
                  ${item.location_text ? `üìç ${item.location_text}` : ""} ${date ? ` ‚Ä¢ üïí ${LF.fmtDate(date)}` : ""}
                </div>
                <div class="mb-3">${(item.description || "").replaceAll("<","&lt;")}</div>

                <div class="row g-2">
                  <div class="col-6"><div class="lf-muted small">M√†u</div><div>${item.color || "-"}</div></div>
                  <div class="col-6"><div class="lf-muted small">H√£ng</div><div>${item.brand || "-"}</div></div>
                  <div class="col-12"><div class="lf-muted small">D·∫•u hi·ªáu nh·∫≠n bi·∫øt</div><div>${item.distinctive_marks || "-"}</div></div>
                </div>

                <div class="mt-3 d-flex gap-2">
                  <a class="btn btn-outline-secondary" href="/index.html">Quay l·∫°i</a>
                  ${isOwner ? `<a class="btn btn-outline-primary" href="/app/edit?id=${encodeURIComponent(item._id)}">S·ª≠a</a>` : ``}
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6">
              <div class="lf-card p-3">
                <h5>·∫¢nh</h5>
                ${imgs.length ? `<div class="lf-preview-grid">${imgs.map((u,i)=>`<div class="lf-preview"><img src="${u}" alt="img ${i+1}"/><div class="lf-preview-tag">#${i+1}</div></div>`).join("")}</div>` : `<div class="lf-muted">Ch∆∞a c√≥ ·∫£nh.</div>`}
              </div>
            </div>
          </div>
        `;
      }

      async function load() {
        const id = getId();
        if (!id) {
          // Kh√¥ng c√≥ id: quay l·∫°i danh s√°ch tin c·ªßa t√¥i ƒë·ªÉ tr√°nh trang l·ªói
          window.location.href = "/app/my.html";
          return;
        }
        try {
          const item = await LF.getItem(id);
          elLoading.classList.add("d-none");
          elWrap.classList.remove("d-none");
          render(item);
        } catch (e) {
          elLoading.classList.add("d-none");
          showError(e);
        }
      }

      load();
    </script>
  </body>
</html>

